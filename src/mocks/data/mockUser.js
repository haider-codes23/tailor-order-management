/**
 * Mock Users Database
 * 
 * This simulates what your backend database would contain.
 * In a real system, passwords would be hashed, but since this is
 * mock data for frontend development, we're keeping them simple.
 * 
 * Each user represents a different role in your tailoring business,
 * letting you test how the application behaves for different user types.
 */

/**
 * Permission Mapping
 * 
 * Different roles get different sets of permissions.
 * This controls what pages and actions each role can access.
 */
const ROLE_PERMISSIONS = {
  ADMIN: [
    // Admin can do everything
    "ORDERS_VIEW",
    "ORDERS_EDIT",
    "ORDERS_CREATE",
    "ORDERS_CHANGE_STATUS",
    "INVENTORY_VIEW",
    "INVENTORY_UPDATE_STOCK",
    "PRODUCTS_VIEW",
    "PRODUCTS_EDIT",
    "PRODUCTS_CREATE",
    "BOM_EDIT",
    "TASKS_VIEW_ALL",
    "TASKS_CREATE",
    "TASKS_UPDATE_STATUS",
    "QA_UPLOAD_VIDEO",
    "REPORTS_VIEW",
    "ADMIN_USERS",
    "ADMIN_SETTINGS",
    "SHOPIFY_MANAGE",
  ],
  
  SALES: [
    // Sales focuses on orders and customer interaction
    "ORDERS_VIEW",
    "ORDERS_CREATE",
    "ORDERS_EDIT",
    "ORDERS_CHANGE_STATUS", // For approval actions
    "PRODUCTS_VIEW", // Need to see products to create orders
    "INVENTORY_VIEW", // Can check ready stock availability
  ],
  
  PRODUCTION_SUPERVISOR: [
    // Supervisor plans and oversees production
    "ORDERS_VIEW",
    "PRODUCTS_VIEW",
    "BOM_VIEW",
    "INVENTORY_VIEW",
    "TASKS_VIEW_ALL",
    "TASKS_CREATE",
    "TASKS_UPDATE_STATUS",
    "ORDERS_CHANGE_STATUS", // To move orders to production
  ],
  
  WORKER: [
    // Workers only see and complete their assigned tasks
    "TASKS_VIEW_ASSIGNED",
    "TASKS_UPDATE_STATUS",
    "ORDERS_VIEW", // Limited view to see order context
  ],
  
  PURCHASER: [
    // Purchaser manages inventory and materials
    "INVENTORY_VIEW",
    "INVENTORY_UPDATE_STOCK",
    "PRODUCTS_VIEW", // Need to see product BOMs
    "BOM_VIEW",
    "ORDERS_VIEW", // To see material requirements
  ],
  
  QA: [
    // QA uploads videos and checks quality
    "ORDERS_VIEW",
    "QA_UPLOAD_VIDEO",
    "TASKS_VIEW_ALL", // To see production completion
  ],
}

/**
 * Mock Users
 * 
 * These are test accounts you can use during development.
 * Each represents a different role in your system.
 */
export const mockUsers = [
  {
    id: 1,
    name: "Admin User",
    email: "admin@tailor.com",
    password: "admin123", // In real life, this would be hashed
    role: "ADMIN",
    permissions: ROLE_PERMISSIONS.ADMIN,
    status: "ACTIVE",
    avatar: null, // Could add avatar URLs later
    createdAt: "2024-01-01T00:00:00Z",
  },
  {
    id: 2,
    name: "Sarah Sales",
    email: "sales@tailor.com",
    password: "sales123",
    role: "SALES",
    permissions: ROLE_PERMISSIONS.SALES,
    status: "ACTIVE",
    avatar: null,
    createdAt: "2024-01-15T00:00:00Z",
  },
  {
    id: 3,
    name: "Mike Supervisor",
    email: "supervisor@tailor.com",
    password: "super123",
    role: "PRODUCTION_SUPERVISOR",
    permissions: ROLE_PERMISSIONS.PRODUCTION_SUPERVISOR,
    status: "ACTIVE",
    avatar: null,
    createdAt: "2024-02-01T00:00:00Z",
  },
  {
    id: 4,
    name: "John Worker",
    email: "worker@tailor.com",
    password: "worker123",
    role: "WORKER",
    permissions: ROLE_PERMISSIONS.WORKER,
    status: "ACTIVE",
    avatar: null,
    createdAt: "2024-02-10T00:00:00Z",
  },
  {
    id: 5,
    name: "Lisa Purchaser",
    email: "purchaser@tailor.com",
    password: "purchase123",
    role: "PURCHASER",
    permissions: ROLE_PERMISSIONS.PURCHASER,
    status: "ACTIVE",
    avatar: null,
    createdAt: "2024-02-15T00:00:00Z",
  },
  {
    id: 6,
    name: "David QA",
    email: "qa@tailor.com",
    password: "qa123",
    role: "QA",
    permissions: ROLE_PERMISSIONS.QA,
    status: "ACTIVE",
    avatar: null,
    createdAt: "2024-03-01T00:00:00Z",
  },
]

/**
 * Helper function to find a user by email
 */
export function findUserByEmail(email) {
  return mockUsers.find(user => user.email.toLowerCase() === email.toLowerCase())
}

/**
 * Helper function to validate credentials
 * Returns the user object if valid, null if invalid
 */
export function validateCredentials(email, password) {
  const user = findUserByEmail(email)
  
  if (!user) {
    return null // User not found
  }
  
  if (user.password !== password) {
    return null // Wrong password
  }
  
  if (user.status !== "ACTIVE") {
    return null // Account is disabled
  }
  
  return user
}

/**
 * Generate a mock JWT token
 * 
 * In a real system, this would be a cryptographically signed token
 * generated by the backend. For our mock, we just create a string
 * that looks like a JWT (three parts separated by dots).
 * 
 * Real JWTs contain encoded user information and an expiration time.
 */
export function generateMockToken(userId) {
  // JWT format: header.payload.signature
  // We're just making it look realistic for development
  const header = btoa(JSON.stringify({ alg: "HS256", typ: "JWT" }))
  const payload = btoa(JSON.stringify({ 
    userId, 
    iat: Date.now(),
    exp: Date.now() + (15 * 60 * 1000) // Expires in 15 minutes
  }))
  const signature = btoa(`mock-signature-${userId}-${Date.now()}`)
  
  return `${header}.${payload}.${signature}`
}

/**
 * Sanitize user data for sending to frontend
 * 
 * We never send passwords to the frontend, even in mock data.
 * This function removes sensitive fields before returning user data.
 */
export function sanitizeUser(user) {
  const { password, ...sanitizedUser } = user
  return sanitizedUser
}





